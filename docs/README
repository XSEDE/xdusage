xdusage-%VER%-%REL% install instructions This document describes two ways to install xdusage; the preferred way is to use the new RPM, but the legacy method is described for systems that may still require it.

Installing the xdusage RPM:

1) Set your machine to trust the repository.
        This is done by installing the appropriate configuration rpm from 
        http://software.xsede.org/production/repo/repos/
	Once you have found the link to the appropriate configuration rpm,
	install it with 
         # rpm -i http://software.xsede.org/production/repo/repos/XSEDE-Production-config.<OPERATING SYSTEM>.noarch.rpm
	 or
         # zypper install http://software.xsede.org/production/repo/repos/XSEDE-Production-config.<OPERATING SYSTEM>.noarch.rpm

      You should get a warning that looks like:
        warning: XSEDE-Production-config.centos-5-1.noarch.rpm: Header V3 DSA
 signature: NOKEY, key ID bf395672
        This is a gpg trust bootstrapping issue because until you install the
 above RPM, RPM doesn't know which gpg key(s) to trust.  The above RPM installs 
the PGP keys that are needed, but one has to run these commands for RPM to forma
lly recognize them:
           # rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-XSEDE-Production

	NOTE:  If you need the SD&I Development version, you will need to
configure your system to use the XSEDE-Development repository by following
https://software.xsede.org/development/repo/repoconfig.txt

2) Install xdusage.
   To install to the default location of /usr/local/xdusage-%VER%-%REL%, you can simply do:

  # yum install xdusage

   If you want to install it in a different location, say /soft/xdusage-%VER%-%REL%, you can do the following.  Since yum doesn't allow you to specify a prefix,there are a couple of steps to take to download the RPM and install it using rpm.
  To install to a different prefix:
     # yum install yum-downloadonly
     # yum update xdusage -y --downloadonly --downloaddir=./
     # rpm -i --prefix=<INSTALL_DIR> ./xdusage-%VER%%REL%-1.noarch.rpm


3) create the xdusage.admins file, listing, one per line, each user of the local
   system who is an xdusage admin (admins are allowed to perform queries as
   other users).  The xdusage.admins file should be placed in the install dir.

4) edit /etc/sudoers to grant permission for everyone to run xdusage as the non_root user "xdusage" (created when the rpm was installed).  This can be done by adding the two lines from /usr/local/xdusage-%VER%-%REL%/xdusage.sudoers

On SLES11, you may need to use these lines instead, where <not_root_user> should probably be a new user created just for this one program:

# XDUSAGE %VER% %REL%
Defaults>xdusage env_keep="USER XDUSAGE_INSTALL_DIR"
ALL ALL=(xdusage) NOPASSWD: <full path to install dir>/xdusage.pl


5) For each resource at your site that you are deploying xd_usage on, create a file called <full path to install dir>/resource_name that contains the corresponding XDCDB resource_name for that resource.

6) edit <full path to install dir>/xdusage.pl
    On the line:
	 my $PASSWORD="xdusage";
    replace xdusage with the actual password as obtained from the 
    XSEDE SP Coordinator or XSEDE Operations Center.

7) To facilitate incorporation of the target installation directory into users' PATHs, install a modules file for xdusage.  There is a sample file in <install dir>/xdusage.modules that can be copied to /usr/local/Modules/modulefiles/xdusage/%VER%-%REL% (or the appropriate location for your Modules installation) and marked as the default by specifying %VER%-%REL% in the associated /usr/local/Modules/modulefiles/xdusage/.version file.

8) Look at the docs/Testing document for a sanity-check command line to run.












Installing from a tarball (Legacy install method):


Prerequisites:  sudo, and the perl modules DBI, DBD:: Pg (compiled with SSL 
support), Getopt::Long, and Date::Manip.

Note:  If you are building DBD::Pg with SSL support yourself, you must:
		export POSTGRES_LIB="/usr/local/pgsql/lib -lssl -lcrypto"
       before building.  See the INSTALLATION section of 
	http://cpansearch.perl.org/src/TURNSTEP/DBD-Pg-2.19.3/README
       for more details.



xdusage can be installed in several simple steps:

Note:  installation should be done by a non-privileged user.
	(some sites have a convention of a "software" user that owns the 
	 installed software).  The only step that requires privilege is 
	editing /etc/sudoers.

1) Get the latest xdusage package at:
        http://software.teragrid.org/software/xdusage/latest/

2) Untar the package:
	tar -xzvf xdusage-%VER%-%REL%.tgz

3) cd xdusage-%VER%-%REL%/bin

4) run install.pl, giving as parameters the user that xdusage should run as, and the installation   directory:
	./install.pl -user <not_a_root_user> -dir <full path to install dir>
   Note:  xdusage should be run as a non-root user that does not map to an 
	actual person.  This can be the "software" user.

5) create the xdusage.admins file, listing, one per line, each user of the local
   system who is an xdusage admin (admins are allowed to perform queries as
   other users).  The xdusage.admins file should be placed in the install dir.

6) edit /etc/sudoers to grant permission for everyone to run xdusage as the non_root user specified in 4) above.  This can be done by adding these two lines:

Defaults!<full path to install dir>/xdusage.pl env_keep="USER XDUSAGE_INSTALL_DIR"
ALL ALL=(<not_a_root_user>) NOPASSWD: <full path to install dir>/xdusage.pl

On SLES11, you may need to use these lines instead, where <not_root_user> should probably be a new user created just for this one program:

# XDUSAGE %VER% %REL%
Defaults><not_root_user> env_keep="USER XDUSAGE_INSTALL_DIR"
ALL ALL=(<not_root_user>) NOPASSWD: <full path to install dir>/xdusage.pl

7) For each resource at your site that you are deploying xd_usage on, create a file called <full path to install dir>/resource_name that contains the corresponding XDCDB resource_name for that resource.

8) edit <full path to install dir>/xdusage.pl
    On the line:
	 my $PASSWORD="xdusage";
    replace xdusage with the actual password as obtained from the 
    XSEDE SP Coordinator or XSEDE Operations Center.

9) To facilitate incorporation of the target installation directory into users' PATHs, install a modules file for xdusage.  There is a sample file in <install dir>/xdusage.modules that can be copied to /usr/local/Modules/modulefiles/xdusage/%VER%-%REL% (or the appropriate location for your Modules installation) and marked as the default by specifying %VER%-%REL% in the associated /usr/local/Modules/modulefiles/xdusage/.version file.

10) Look at the docs/Testing document for a sanity-check command line to run.
